/*!
 * Tatami-rails-adaptor v0.1.8
 * 
 *
 * Copyright 2013, 2014 Ourairyu, http://ourai.ws/
 *
 * Date: 2014-08-25
 */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return Tatami.isPlainObject(Tatami.rails)?!1:(s=Tatami,i=new s.__class__.Storage("pageHandlers"),p={},b={},c=void 0,r=(null!=(t=this.Turbolinks)?t.supported:void 0)===!0,j=!1,s.mixin({rails:{turbolinks:{enabled:r,handlers:i.storage,sequence:p,counter:b}}}),r&&!function(){var a,b,c,e;return b=Node.prototype.insertBefore,a=0,e=0,c=function(){return a++,this.setAttribute("data-loaded",!0),a===e?n(d(!0),"ready"):void 0},Node.prototype.insertBefore=function(a){return 1===a.nodeType&&"script"===a.tagName.toLowerCase()&&s.data(a).inside&&(e++,a.async=!1,a.onload=c),b.apply(this,arguments)}}(),q=function(a){return a.replace("-","_")},g=function(a,b,c,d){var e,f;return f=i.get(""+b+"."+a+"."+d),e=!1,null!=f&&s.each(f,function(a){return e=s.hasProp("id",a)||s.hasProp("id",c)?c.id===a.id:s.equal(c,a),!e}),e},h=function(a,c,d){var e,f,h;return e=(null!=d.id?""+d.id+"_":"")+d.toString().length.toString(16),s.namespace(b,e),g(a,c,d,e)||(b[e]=(null!=(h=b[e])?h:0)+1,f=""+e+"."+b[e]),f},k=function(a,b,c){var d;return d=s.namespace(p,""+a+"."+b),null==d&&(d=p[a][b]=[]),d.push(c)},e=function(a,b,c){var d,e,f;e=i.storage[a][b],f=c.split(".");try{delete e[f[0]][f[1]]}catch(g){d=g,e[f[0]][f[1]]=void 0}p[a][b]=s.filter(p[a][b],function(a){return a!==c})},f=function(a,b){var d,e;return e=b[1],d=s.isBoolean(e)?e:b[2],e=null!=e&&s.isString(e)?q(e):c,[a,[e],b[0],d]},a=function(a,b,c,d){var e,f;return f=s.isPlainObject(b),e={},s.each(b,function(b,g){var i,j;return f&&(c=b,b=g),d&&(c.execOnce=!0),null==b&&(b="unspecified"),b=q(b),i=h(a,b,c),null!=i&&(s.namespace(e,""+b+"."+a+"."+i),j=i.split("."),e[b][a][j[0]][j[1]]=c,k(b,a,i)),!0}),i.set(e)},n=function(a,b,c){var d,f;return d=null!=(f=i.storage[a])?f[b]:void 0,d?s.each(p[a][b],function(f){var g,h;return h=f.split("."),g=d[h[0]][h[1]],c&&c(),g(),g.execOnce?e(a,b,f):void 0}):void 0},m=function(a){var b,c,e;return c=["unspecified"],b=d(!0),e=$("body script[data-inside]:not([data-turbolinks-eval='false'][data-loaded='true'])"),"prepare"!==a&&r&&j&&0!==e.size()||c.push(b),s.each(c,function(b){return n(b,a)})},o=function(a,b,c){return s.each(a,function(a,d){return c&&(b=a,a=d),$("body").is("[data-page='"+a+"']")?(b(),!1):void 0})},d=function(a){var b;return b=$("body").data("page"),a===!0?q(b):b},s.extend({handlers:[{name:"inPage",handler:function(b,c,e){var f,g,h;return g=this.isPlainObject(b),1!==arguments.length||g?(this.isString(b)&&(b=[b]),f=[b,c],e===!0||null==document.body?(f.unshift("init"),a.apply(this,f)):(f.push(g),o.apply(this,f))):(this.isArray(b)||(b=[b]),h=this.inArray(d(),b)>-1),h||!1},validator:function(a){return this.isString(a)||this.isArray(a)||this.isPlainObject(a)},value:!1},{name:"runInWidget",handler:function(){var a,b,c,d;return a=this.slice(arguments),c=a[0],this.isFunction(c)&&(b=c,a=this.slice(a,1),c=a[0]),this.functionExists(c)?this.run.apply(this,a):(d=function(c){return function(){return b&&b(),c.run.apply(c,a)}}(this),d.id=c,this.ready(d,$("body").data("page"),!0))}}]}),void(s.hasProp("supported",this.Turbolinks)&&(s.mixin({prepare:function(){a.apply(this,f("prepare",arguments))},ready:function(){a.apply(this,f("ready",arguments))}}),l=function(){var a;return a=d(!0),n(a,"init",function(){return c=a}),m("prepare"),m("ready")},s.init({runSandbox:function(){return $(document).on({"page:fetch":function(){return j=!0,s.destroySystemDialogs()},"page:load":function(){return j=!1}}),$(document).ready(function(){return l()})}}))))}).call(this);
//# sourceMappingURL=tatami-rails-adaptor.min.map