/*!
 * Tatami-rails-adaptor v0.1.0
 * 
 *
 * Copyright 2013, 2014 Ourairyu, http://ourai.ws/
 *
 * Date: 2014-08-03
 */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return Tatami.isPlainObject(null!=(u=Tatami.adaptor)?u.rails:void 0)?!1:(t=Tatami,k=new t.__class__.Storage("pageHandlers"),q={},g={},e=void 0,s=(null!=(v=this.Turbolinks)?v.supported:void 0)===!0,t.mixin({adaptor:{rails:{turbolinks:{enabled:s,handlers:k.storage,sequence:q,execution:g}}}}),s&&!function(){var a,b,c,d;return b=Node.prototype.insertBefore,a=0,d=0,c=function(){return a++,this.setAttribute("data-loaded",!0),console.log(this.src),a===d?o.apply(t,[f(!0),"ready"]):void 0},Node.prototype.insertBefore=function(a){return"script"===a.tagName.toLowerCase()&&t.data(a).inside&&(d++,a.async=!1,a.onload=c),b.apply(this,arguments)}}(),r=function(a){return a.replace("-","_")},i=function(a){return a.toString().length.toString(16)+""},h=function(a,b,c,d){return this.equal(c,k.get(""+b+"."+a+"."+d))},l=function(a,b,c){var d;return d=this.namespace(q,""+a+"."+b),null==d&&(d=q[a][b]=[]),d.push(c)},j=function(a,b,c){var d;return d=this.namespace(g,""+a+"."+b+"."+c),null===d?g[a][b][c]=!1:void 0},c=function(a,b,c,d){var e;return e={},this.each(b,function(b){return function(f,g){var k;return d&&(c=f,f=g),null==f&&(f="unspecified"),f=r(f),k=i(c),h.apply(b,[a,f,c,k])?void 0:(b.namespace(e,""+f+"."+a+"."+k),e[f][a][k]=c,l.apply(b,[f,a,k]),j.apply(b,[f,a,k]))}}(this)),k.set(e)},o=function(a,b,c){var d,e,f;return d=null!=(f=k.storage[a])?f[b]:void 0,d?(e=g[a][b],this.each(q[a][b],function(b){return c&&c(),"unspecified"===a||e[b]===!1?(e[b]=!0,d[b]()):void 0})):void 0},n=function(a){var b,c,d;return c=["unspecified"],b=f(!0),d=$("body script[data-inside]:not([data-turbolinks-eval='false'][data-loaded='true'])"),"prepare"!==a&&s&&0!==d.size()||c.push(b),this.each(c,function(b){return function(c){return o.apply(b,[c,a])}}(this))},p=function(a,b,c){return this.each(a,function(a,d){return c&&(b=a,a=d),$("body").is("[data-page='"+a+"']")?(b(),!1):void 0})},f=function(a){var b;return b=$("body").data("page"),a===!0?r(b):b},t.extend({handlers:[{name:"inPage",handler:function(a,b,d){var e,g,h;return g=this.isPlainObject(a),1!==arguments.length||g?(this.isString(a)&&(a=[a]),e=[a,b,g],d===!0||null==document.body?(e.unshift("init"),c.apply(this,e)):p.apply(this,e)):(this.isArray(a)||(a=[a]),h=this.inArray(f(),a)>-1),h||!1},validator:function(a){return this.isString(a)||this.isArray(a)||this.isPlainObject(a)},value:!1}]}),void(t.hasProp("supported",this.Turbolinks)&&(d=!0,t.mixin({prepare:function(a){c.call(this,"prepare",[e],a)},ready:function(a,b){c.call(this,"ready",[null!=b?r(b):e],a)}}),m=function(){var a;return console.log("Run! Run!! Run!!!"),a=f(!0),o.call(this,a,"init",function(){return e=a}),n.call(this,"prepare"),n.call(this,"ready")},a=$(document),b={isReady:!1,use:function(b,c,d){return a.off(".adaptor").on(""+b+".adaptor",this.onLoad).on(""+c+".adaptor",this.onFetch).on(""+d+".adaptor",this.onExpire)},addCallback:function(c){return b.isReady?c($):a.on("adaptor:ready",function(){return c($)})},onLoad:function(){return b.isReady=!0,a.trigger("adaptor:ready")},onFetch:function(){return b.isReady=!1},onExpire:function(a){return delete g[r($(a.body).data("page"))]},register:function(){return $(this.onLoad),$.fn.ready=this.addCallback}},t.init({runSandbox:function(){return b.register(),b.use("page:load","page:fetch","page:expire"),a.ready(function(a){return function(){return m.call(a)}}(this))}}))))}).call(this);
//# sourceMappingURL=tatami-rails-adaptor.min.map