/*!
 * Tatami-rails-adaptor v0.1.0
 * 
 *
 * Copyright 2013, 2014 Ourairyu, http://ourai.ws/
 *
 * Date: 2014-08-18
 */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return Tatami.isPlainObject(null!=(s=Tatami.adaptor)?s.rails:void 0)?!1:(r=Tatami,h=new r.__class__.Storage("pageHandlers"),o={},e={},b=void 0,q=(null!=(t=this.Turbolinks)?t.supported:void 0)===!0,i=!1,r.mixin({adaptor:{rails:{turbolinks:{enabled:q,handlers:h.storage,sequence:o,execution:e}}}}),q&&!function(){var a,b,d,e;return b=Node.prototype.insertBefore,a=0,e=0,d=function(){return a++,this.setAttribute("data-loaded",!0),a===e?m.apply(r,[c(!0),"ready"]):void 0},Node.prototype.insertBefore=function(a){return"script"===a.tagName.toLowerCase()&&r.data(a).inside&&(e++,a.async=!1,a.onload=d),b.apply(this,arguments)}}(),p=function(a){return a.replace("-","_")},g=function(a){return(null!=a.id?""+a.id+"_":"")+a.toString().length.toString(16)},f=function(a,b,c,d){var e,f;return f=h.get(""+b+"."+a+"."+d),e=this.hasProp("id",f)||this.hasProp("id",c)?c.id===f.id:this.equal(c,f)},j=function(a,b,c){var d;return d=this.namespace(o,""+a+"."+b),null==d&&(d=o[a][b]=[]),d.push(c)},d=function(a,b,c){var d,e;e=h.storage[a][b];try{delete e[c]}catch(f){d=f,e[c]=void 0}o[a][b]=this.filter(o[a][b],function(a){return a!==c})},a=function(a,b,c,d){var e,i;return i=this.isPlainObject(b),e={},this.each(b,function(b){return function(h,k){var l;return i&&(c=h,h=k),d&&(c.execOnce=!0),null==h&&(h="unspecified"),h=p(h),l=g(c),f.apply(b,[a,h,c,l])||(b.namespace(e,""+h+"."+a+"."+l),e[h][a][l]=c,j.apply(b,[h,a,l])),!0}}(this)),h.set(e)},m=function(a,b,c){var e,f;return e=null!=(f=h.storage[a])?f[b]:void 0,e?this.each(o[a][b],function(f){return function(g){var h;return h=e[g],c&&c(),h(),h.execOnce?d.apply(f,[a,b,g]):void 0}}(this)):void 0},l=function(a){var b,d,e;return d=["unspecified"],b=c(!0),e=$("body script[data-inside]:not([data-turbolinks-eval='false'][data-loaded='true'])"),"prepare"!==a&&q&&i&&0!==e.size()||d.push(b),this.each(d,function(b){return function(c){return m.apply(b,[c,a])}}(this))},n=function(a,b,c){return this.each(a,function(a,d){return c&&(b=a,a=d),$("body").is("[data-page='"+a+"']")?(b(),!1):void 0})},c=function(a){var b;return b=$("body").data("page"),a===!0?p(b):b},r.extend({handlers:[{name:"inPage",handler:function(b,d,e){var f,g,h;return g=this.isPlainObject(b),1!==arguments.length||g?(this.isString(b)&&(b=[b]),f=[b,d],e===!0||null==document.body?(f.unshift("init"),a.apply(this,f)):(f.push(g),n.apply(this,f))):(this.isArray(b)||(b=[b]),h=this.inArray(c(),b)>-1),h||!1},validator:function(a){return this.isString(a)||this.isArray(a)||this.isPlainObject(a)},value:!1}]}),void(r.hasProp("supported",this.Turbolinks)&&(r.mixin({prepare:function(c){a.apply(this,["prepare",[b],c])},ready:function(c,d,e){a.apply(this,["ready",[null!=d?p(d):b],c,e])}}),k=function(){var a;return a=c(!0),m.call(this,a,"init",function(){return b=a}),l.call(this,"prepare"),l.call(this,"ready")},r.init({runSandbox:function(){return $(document).on({"page:fetch":function(){return r.destroySystemDialogs(),i=!0},"page:load":function(){return i=!1}}),$(document).ready(function(a){return function(){return k.call(a)}}(this))}}))))}).call(this);
//# sourceMappingURL=tatami-rails-adaptor.min.map