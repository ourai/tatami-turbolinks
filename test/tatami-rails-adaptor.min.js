/*!
 * Tatami-rails-adaptor v0.1.0
 * 
 *
 * Copyright 2013, 2014 Ourairyu, http://ourai.ws/
 *
 * Date: 2014-08-20
 */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return Tatami.isPlainObject(null!=(t=Tatami.adaptor)?t.rails:void 0)?!1:(s=Tatami,i=new s.__class__.Storage("pageHandlers"),p={},e={},b=void 0,r=(null!=(u=this.Turbolinks)?u.supported:void 0)===!0,j=!1,s.mixin({adaptor:{rails:{turbolinks:{enabled:r,handlers:i.storage,sequence:p,execution:e}}}}),r&&!function(){var a,b,d,e;return b=Node.prototype.insertBefore,a=0,e=0,d=function(){return a++,this.setAttribute("data-loaded",!0),a===e?n(c(!0),"ready"):void 0},Node.prototype.insertBefore=function(a){return"script"===a.tagName.toLowerCase()&&s.data(a).inside&&(e++,a.async=!1,a.onload=d),b.apply(this,arguments)}}(),q=function(a){return a.replace("-","_")},h=function(a){return(null!=a.id?""+a.id+"_":"")+a.toString().length.toString(16)},g=function(a,b,c,d){var e,f;return f=i.get(""+b+"."+a+"."+d),e=s.hasProp("id",f)||s.hasProp("id",c)?c.id===f.id:s.equal(c,f)},k=function(a,b,c){var d;return d=s.namespace(p,""+a+"."+b),null==d&&(d=p[a][b]=[]),d.push(c)},d=function(a,b,c){var d,e;e=i.storage[a][b];try{delete e[c]}catch(f){d=f,e[c]=void 0}p[a][b]=s.filter(p[a][b],function(a){return a!==c})},f=function(a,c){var d,e;return e=c[1],d=s.isBoolean(e)?e:c[2],e=null!=e&&s.isString(e)?q(e):b,[a,[e],c[0],d]},a=function(a,b,c,d){var e,f;return f=s.isPlainObject(b),e={},s.each(b,function(b,i){var j;return f&&(c=b,b=i),d&&(c.execOnce=!0),null==b&&(b="unspecified"),b=q(b),j=h(c),g(a,b,c,j)||(s.namespace(e,""+b+"."+a+"."+j),e[b][a][j]=c,k(b,a,j)),!0}),i.set(e)},n=function(a,b,c){var e,f;return e=null!=(f=i.storage[a])?f[b]:void 0,e?s.each(p[a][b],function(f){var g;return g=e[f],c&&c(),g(),g.execOnce?d(a,b,f):void 0}):void 0},m=function(a){var b,d,e;return d=["unspecified"],b=c(!0),e=$("body script[data-inside]:not([data-turbolinks-eval='false'][data-loaded='true'])"),"prepare"!==a&&r&&j&&0!==e.size()||d.push(b),s.each(d,function(b){return n(b,a)})},o=function(a,b,c){return s.each(a,function(a,d){return c&&(b=a,a=d),$("body").is("[data-page='"+a+"']")?(b(),!1):void 0})},c=function(a){var b;return b=$("body").data("page"),a===!0?q(b):b},s.extend({handlers:[{name:"inPage",handler:function(b,d,e){var f,g,h;return g=this.isPlainObject(b),1!==arguments.length||g?(this.isString(b)&&(b=[b]),f=[b,d],e===!0||null==document.body?(f.unshift("init"),a.apply(this,f)):(f.push(g),o.apply(this,f))):(this.isArray(b)||(b=[b]),h=this.inArray(c(),b)>-1),h||!1},validator:function(a){return this.isString(a)||this.isArray(a)||this.isPlainObject(a)},value:!1}]}),void(s.hasProp("supported",this.Turbolinks)&&(s.mixin({prepare:function(){a.apply(this,f("prepare",arguments))},ready:function(){a.apply(this,f("ready",arguments))}}),l=function(){var a;return a=c(!0),n(a,"init",function(){return b=a}),m("prepare"),m("ready")},s.init({runSandbox:function(){return $(document).on({"page:fetch":function(){return j=!0,s.destroySystemDialogs()},"page:load":function(){return j=!1}}),$(document).ready(function(){return l()})}}))))}).call(this);
//# sourceMappingURL=tatami-rails-adaptor.min.map